<%- include('../partials/header') %>
<div class="flex min-h-screen bg-gray-50">
    <%- include('../partials/admin_sidebar') %>
    <main class="flex-1 p-10">
        <%- include('../partials/flash') %>
        <header class="mb-10 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Selamat Datang, Admin!</h1>
                <p class="text-gray-500">Ringkasan data bisnis Sambal Bledheg Nyah Uban 321.</p>
            </div>
            <a href="/" target="_blank" class="px-6 py-2 bg-gray-900 text-white rounded-xl text-sm font-bold shadow-lg">Lihat Website <i class="fas fa-external-link-alt ml-2"></i></a>
        </header>

        <div class="grid md:grid-cols-3 gap-8">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
                <div class="w-12 h-12 bg-red-100 text-red-600 rounded-2xl flex items-center justify-center text-xl mb-4"><i class="fas fa-box"></i></div>
                <div class="text-4xl font-bold text-gray-900"><%= counts.products %></div>
                <div class="text-gray-500 font-medium">Total Produk</div>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
                <div class="w-12 h-12 bg-green-100 text-green-600 rounded-2xl flex items-center justify-center text-xl mb-4"><i class="fas fa-money-bill-wave"></i></div>
                <div class="text-4xl font-bold text-gray-900">Rp <%= Number(counts.revenue).toLocaleString('id-ID') %></div>
                <div class="text-gray-500 font-medium">Total Omset</div>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
                <div class="w-12 h-12 bg-orange-100 text-orange-600 rounded-2xl flex items-center justify-center text-xl mb-4"><i class="fas fa-images"></i></div>
                <div class="text-4xl font-bold text-gray-900"><%= counts.gallery %></div>
                <div class="text-gray-500 font-medium">Foto Galeri</div>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
                <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center text-xl mb-4"><i class="fas fa-star"></i></div>
                <div class="text-4xl font-bold text-gray-900"><%= counts.testimonials %></div>
                <div class="text-gray-500 font-medium">Testimoni Masuk</div>
            </div>
        </div>

        <div class="mt-12 grid lg:grid-cols-2 gap-8">
            <!-- Sales Chart -->
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
                <h2 class="text-xl font-bold mb-6">Tren Penjualan (7 Hari Terakhir)</h2>
                <canvas id="salesChart"></canvas>
            </div>

            <!-- Products Chart -->
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
                <h2 class="text-xl font-bold mb-6">5 Produk Terlaris</h2>
                <canvas id="productsChart"></canvas>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Sales Data
            const salesData = <%- JSON.stringify(chart.sales || []) %>;
            const salesDates = salesData.map(d => {
                const date = new Date(d.date);
                return date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
            });
            const salesTotals = salesData.map(d => d.total);

            const ctxSales = document.getElementById('salesChart').getContext('2d');
            new Chart(ctxSales, {
                type: 'line',
                data: {
                    labels: salesDates,
                    datasets: [{
                        label: 'Total Penjualan (Rp)',
                        data: salesTotals,
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Products Data
            const productsData = <%- JSON.stringify(chart.products || []) %>;
            const productNames = productsData.map(p => p.product_name);
            const productQtys = productsData.map(p => p.qty);
            const colors = ['#fca5a5', '#f87171', '#dc2626', '#b91c1c', '#7f1d1d'];

            const ctxProducts = document.getElementById('productsChart').getContext('2d');
            new Chart(ctxProducts, {
                type: 'doughnut',
                data: {
                    labels: productNames,
                    datasets: [{
                        data: productQtys,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        </script>
    </main>
</div>
<%- include('../partials/footer') %>
